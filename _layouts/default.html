<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% if page.title %}{{ page.title }} - {% endif %}CS249r: Architecture 2.0</title>
    {% seo %}
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="{{ site.url }}{{ page.url }}">
    <meta property="og:title" content="{% if page.title %}{{ page.title }} - {% endif %}CS249r: Architecture 2.0 - Agentic AI for Computer Systems Design">
    <meta property="og:description" content="Harvard University Fall 2025 - Exploring how agentic AI systems are transforming computer systems design across software, architecture, and chip design. Taught by Prof. Vijay Janapa Reddi.">
    <meta property="og:image" content="{{ site.url }}/assets/images/cs249r-logo.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:site_name" content="CS249r: Architecture 2.0">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="{{ site.url }}{{ page.url }}">
    <meta property="twitter:title" content="{% if page.title %}{{ page.title }} - {% endif %}CS249r: Architecture 2.0">
    <meta property="twitter:description" content="Harvard University Fall 2025 - Exploring how agentic AI systems are transforming computer systems design across software, architecture, and chip design.">
    <meta property="twitter:image" content="{{ site.url }}/assets/images/cs249r-logo.png">
    
    <!-- Additional meta tags -->
    <meta name="description" content="CS249r: Architecture 2.0 - Agentic AI for Computer Systems Design at Harvard University. Exploring how AI agents design software, architecture, and chips.">
    <meta name="keywords" content="AI, Computer Architecture, Chip Design, Harvard, CS249r, Agentic AI, Computer Systems">
    <meta name="author" content="Vijay Janapa Reddi">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="{{ site.baseurl }}/assets/images/favicon.ico">
    <link rel="apple-touch-icon" href="{{ site.baseurl }}/assets/images/cs249r-logo.png">
    <link rel="stylesheet" href="{{ site.baseurl }}/assets/css/main.css">
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div>
                <a href="{{ site.baseurl }}/" style="text-decoration: none; color: inherit;">
                    <h1>Architecture 2.0</h1>
                    <div class="subtitle">Agentic AI for Computer Systems Design</div>
                </a>
            </div>
            <div style="text-align: right; font-size: 0.9rem;">
                <strong>CS249r</strong><br>
                Harvard University ‚Ä¢ Fall 2025
            </div>
        </div>
    </header>
    
    <div class="nav-bar">
        <div class="nav-content">
            <button class="nav-toggle" aria-label="toggle navigation">
                <span class="hamburger"></span>
            </button>
            <nav>
                <ul>
                    <li><a href="{{ site.baseurl }}/">üè† Home</a></li>
                    <li><a href="{{ site.baseurl }}/course/syllabus">üìã Syllabus</a></li>
                    <li><a href="{{ site.baseurl }}/course/schedule">üìÖ Schedule</a></li>
                    <li><a href="{{ site.baseurl }}/course/assignments">üìù Assignments</a></li>
                    <li><a href="{{ site.baseurl }}/course/resources">üìö Resources</a></li>
                    <li><a href="{{ site.baseurl }}/papers">üìÑ Papers</a></li>
                    <li><a href="{{ site.baseurl }}/blog">‚úçÔ∏è Blog</a></li>
                    <li><a href="{{ site.baseurl }}/course/news">üì∞ News</a></li>
                </ul>
            </nav>
        </div>
    </div>
    
    <main class="main-content">
        <div class="content-wrapper">
            {{ content }}
        </div>
    </main>
    
    <!-- Mermaid.js for diagrams -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    <script>
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            themeVariables: {
                primaryColor: '#A51C30',
                primaryTextColor: '#333',
                primaryBorderColor: '#8B1538',
                lineColor: '#666',
                secondaryColor: '#f8f9fa',
                tertiaryColor: '#e9ecef'
            }
        });
    </script>
    <script>
        const navToggle = document.querySelector('.nav-toggle');
        const nav = document.querySelector('.nav-bar nav');

        navToggle.addEventListener('click', () => {
            nav.classList.toggle('nav--visible');
        });

        document.addEventListener('DOMContentLoaded', function() {
            const tables = document.querySelectorAll('.content-wrapper table');
            tables.forEach(function(table) {
                const tableContainer = document.createElement('div');
                tableContainer.className = 'table-container';
                table.parentNode.insertBefore(tableContainer, table);
                tableContainer.appendChild(table);
            });

            // Generate Table of Contents
            const tocList = document.querySelector('.toc-list');
            const blogContent = document.querySelector('.blog-content');
            
            if (tocList && blogContent) {
                const headings = blogContent.querySelectorAll('h2, h3');
                
                if (headings.length > 0) {
                    headings.forEach((heading, index) => {
                        // Add ID to heading if it doesn't have one
                        if (!heading.id) {
                            heading.id = 'heading-' + index;
                        }
                        
                        const li = document.createElement('li');
                        const a = document.createElement('a');
                        a.href = '#' + heading.id;
                        a.textContent = heading.textContent;
                        
                        // Add class for H3 to indent them
                        if (heading.tagName === 'H3') {
                            a.classList.add('toc-h3');
                        }
                        
                        a.addEventListener('click', (e) => {
                            e.preventDefault();
                            heading.scrollIntoView({ behavior: 'smooth', block: 'start' });
                            // Update URL without jumping
                            history.pushState(null, null, '#' + heading.id);
                        });
                        
                        li.appendChild(a);
                        tocList.appendChild(li);
                    });
                    
                    // Scroll spy - highlight current section
                    let ticking = false;
                    function updateActiveLink() {
                        if (!ticking) {
                            window.requestAnimationFrame(() => {
                                const scrollPos = window.scrollY + 150;
                                const tocLinks = tocList.querySelectorAll('a');
                                
                                let currentHeading = null;
                                headings.forEach(heading => {
                                    if (heading.offsetTop <= scrollPos) {
                                        currentHeading = heading;
                                    }
                                });
                                
                                tocLinks.forEach(link => {
                                    link.classList.remove('active');
                                    if (currentHeading && link.getAttribute('href') === '#' + currentHeading.id) {
                                        link.classList.add('active');
                                        // Auto-scroll TOC to keep active item visible
                                        const tocSidebar = document.querySelector('.toc-sidebar');
                                        if (tocSidebar && link) {
                                            const linkTop = link.offsetTop;
                                            const linkBottom = linkTop + link.offsetHeight;
                                            const scrollTop = tocSidebar.scrollTop;
                                            const scrollBottom = scrollTop + tocSidebar.clientHeight;
                                            
                                            // Check if link is outside visible area
                                            if (linkTop < scrollTop) {
                                                // Scroll up to show link at top
                                                tocSidebar.scrollTop = linkTop - 20;
                                            } else if (linkBottom > scrollBottom) {
                                                // Scroll down to show link at bottom
                                                tocSidebar.scrollTop = linkBottom - tocSidebar.clientHeight + 20;
                                            }
                                        }
                                    }
                                });
                                
                                ticking = false;
                            });
                            ticking = true;
                        }
                    }
                    
                    window.addEventListener('scroll', updateActiveLink);
                    updateActiveLink(); // Initial call
                } else {
                    // Hide TOC if no headings
                    const tocSidebar = document.getElementById('table-of-contents');
                    if (tocSidebar) tocSidebar.style.display = 'none';
                }
            }
            
            // TOC Toggle for mobile
            const tocToggle = document.querySelector('.toc-toggle');
            const tocSidebar = document.getElementById('table-of-contents');
            
            if (tocToggle && tocSidebar) {
                tocToggle.addEventListener('click', () => {
                    tocSidebar.classList.toggle('collapsed');
                });
            }

            // Image zoom functionality
            const blogContentForImages = document.querySelector('.blog-content');
            if (blogContentForImages) {
                // Create modal elements
                const modal = document.createElement('div');
                modal.className = 'image-modal';
                modal.innerHTML = `
                    <span class="image-modal-close">&times;</span>
                    <img class="image-modal-content" alt="Zoomed image">
                    <div class="image-modal-caption"></div>
                `;
                document.body.appendChild(modal);

                const modalImg = modal.querySelector('.image-modal-content');
                const modalCaption = modal.querySelector('.image-modal-caption');
                const closeBtn = modal.querySelector('.image-modal-close');

                // Add click handlers to all images in blog content
                const images = blogContentForImages.querySelectorAll('img');
                images.forEach(img => {
                    // Skip margin note images and very small images
                    if (img.closest('.margin-note') || img.width < 100) {
                        return;
                    }

                    img.addEventListener('click', function() {
                        modal.classList.add('active');
                        modalImg.src = this.src;
                        modalCaption.textContent = this.alt || '';
                        document.body.style.overflow = 'hidden';
                    });
                });

                // Close modal on click
                closeBtn.addEventListener('click', () => {
                    modal.classList.remove('active');
                    document.body.style.overflow = '';
                });

                modal.addEventListener('click', (e) => {
                    if (e.target === modal || e.target === modalImg) {
                        modal.classList.remove('active');
                        document.body.style.overflow = '';
                    }
                });

                // Close on escape key
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape' && modal.classList.contains('active')) {
                        modal.classList.remove('active');
                        document.body.style.overflow = '';
                    }
                });
            }
        });
    </script>
<!-- Force rebuild trigger 2 -->
</body>
</html>
